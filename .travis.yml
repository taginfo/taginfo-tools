#-----------------------------------------------------------------------------
#
#  Configuration for continuous integration service at travis-ci.org
#
#-----------------------------------------------------------------------------

language: generic

os: linux

dist: bionic

#-----------------------------------------------------------------------------

addons:
  apt:
    packages:
      - libgd-dev
      - libsparsehash-dev
      - libutfcpp-dev
      - sqlite3

#-----------------------------------------------------------------------------

jobs:
  include:

    # Linux Clang Builds

    - dist: xenial
      env: CC='clang' CXX='clang++' BUILD_TYPE='Dev'

    - env: CC='clang' CXX='clang++' BUILD_TYPE='Dev'

    - dist: focal
      env: CC='clang' CXX='clang++' BUILD_TYPE='Dev'

    - dist: focal
      env: CC='clang' CXX='clang++' BUILD_TYPE='Release'

    # Linux GCC Builds

    - dist: xenial
      env: CC='gcc-5' CXX='g++-5' BUILD_TYPE='Dev'

    - env: CC='gcc-7' CXX='g++-7' BUILD_TYPE='Dev'

    - dist: focal
      env: CC='gcc-9' CXX='g++-9' BUILD_TYPE='Dev'

    - dist: focal
      env: CC='gcc-9' CXX='g++-9' BUILD_TYPE='Release'

#-----------------------------------------------------------------------------

install:
  - git clone --quiet --depth 1 https://github.com/osmcode/libosmium.git ../libosmium
  - git clone --quiet --depth 1 https://github.com/mapbox/protozero.git ../protozero

before_script:
  - mkdir build && cd build
  - cmake -LA .. -DCMAKE_BUILD_TYPE=${BUILD_TYPE} -DOSMIUM_INCLUDE_DIR=${TRAVIS_BUILD_DIR}/../libosmium/include -DPROTOZERO_INCLUDE_DIR=${TRAVIS_BUILD_DIR}/../protozero/include -DCMAKE_CXX_FLAGS=-Werror

script:
  - make VERBOSE=1 && ctest --output-on-failure

#-----------------------------------------------------------------------------
